------------------------------------------------
-------- Dataset do repositório do GBIF -------- 
------------------------------------------------


-- Base = `bigquery-public-data.gbif.occurrences`
-- Plataforma = Google Cloud

-- Ideia do da view é ter o número de indiviuos e especies diferentes existentes dentro da tabela
-- Resumidamente -> seleciono todas as especies, número de individuos vistos, país e ano
-- Depois dou pivot na tabela para ter os países em colunas ao mesmo tempo que puxo a soma dos inviduos e seleciono as especies diferentes que tem dentro da tabela para cada país e ano



with tempi as (
select 
  sum(individualcount) as individuos,
  countrycode,
  year,
  count(distinct species) as especies
 from `bigquery-public-data.gbif.occurrences` 
where taxonrank         = 'SPECIES' 
        AND YEAR        >= 1945 
        AND countrycode is not null  
        AND species     is not null
group by countrycode, year
)
